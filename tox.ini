[tox]
isolated_build = true
envlist = clean, py{38,35, 36, 37}, lint, report

[testenv]
description = run tests
deps =
	pytest
	pytest-cov
	pytest-travis-fold
passenv =
  	CI
  	TRAVIS
  	TRAVIS_*
commands =
	py{38,35,36}: pytest --cov --cov-append {posargs:-vv} tests/
	py37: pytest tests/

[testenv:clean]
description = cleans data
deps = coverage
skip_install = true
commands = coverage erase

[testenv:lint]
description = code linting
basepython =
	python3.8
deps = flake8
commands = flake8

[testenv:report]
description = provide test coverage reports
basepython =
	python3.8
deps =
	python-dotenv[cli]
	coverage
	codecov
passenv =
  	CI
  	TRAVIS
  	TRAVIS_*
skip_install = true
commands =
    coverage report
    coverage html
    !travis: dotenv -f .varsenv run codecov
    travis: codecov

[travis]
os =
	osx: clean, py{35, 36, 37, 38}, lint, report
python =
  3.7: py37, lint, report

[flake8]
exclude =
	.tox,
	.direnv,
	.eggs